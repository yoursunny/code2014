var GPA={};GPA.Course=Class.create({id:-1,name:"",credit:"",grade:"",code:"",selected:true,point:0,cp:0});
GPA.CourseCollection=Class.create({initialize:function(){this.H=$H()},Add:function(a){if(a.id<0){do a.id=(Math.random()*16777216).floor();while(this.Contains(a.id))}this.H.set(a.id,a);return a.id},AddRange:function(a,b,d){if(arguments.length<3){b=0;d=a.length}for(var e=b,f=b+d;e<f;++e)this.Add(a[e])},Remove:function(a){return this.H.unset(a)},Contains:function(a){return this.Get(a)!=null},Count:function(){return this.H.keys().length},Get:function(a){return(a=this.H.get(a))?a:null},each:function(a){Object.isFunction(a)&&
this.H.each(function(b){a(b.key,b.value)})},toArray:function(){return this.H.values()},Select:function(a,b){if(a=this.Get(a))a.selected=b},Selected:function(){return this.toArray().select(function(a){return a.selected})},H:null});GPA.Algorithm=Class.create({name:"",initialize:function(a){if(a)this.name=a},p:function(a){return a},ToJS:function(){return"(new GPA.Algorithm("+this.name.inspect()+"))"},canEdit:false,Viewer:function(){},Editor:function(){},EditorSave:function(){}});
GPA.Calculator=Class.create({Courses:null,Algorithm:null,Translator:null});GPA.Calc=new GPA.Calculator;GPA.LoadComponent=function(){var a=$A(arguments);a=[a].flatten().without.apply(a,GPA.LoadComponent.a);if(!(a.length<1)){GPA.showLoading();new Ajax.Request("component.php?"+a.join(","),{asynchronous:false,method:"get",evalJS:"force"});GPA.hideLoading()}};GPA.LoadComponent.a=[];GPA.showLoading=WebSite.showLoading.curry("\u6b63\u5728\u4e0b\u8f7dGPA\u8ba1\u7b97\u5668\u7ec4\u4ef6");GPA.hideLoading=WebSite.hideLoading.defer.bind(WebSite.hideLoading);
GPA.CheckUA=function(){var a=[],b=true,d=navigator.userAgent,e=true;if(Prototype.Browser.Gecko)b=false;else if(Prototype.Browser.IE){d=parseInt(d.substr(d.indexOf("MSIE ")+4));if(d>=6)b=false;d==6&&a.push("\u8ba1\u7b97\u7ed3\u679c\u6f02\u6d6e\u6548\u679c")}else if(Prototype.Browser.Opera){b=false;a.push("\u4e0a\u6d77\u4ea4\u5927\u4fee\u4e1a\u67e5\u8be2")}else if(Prototype.Browser.WebKit){b=false;a.push("\u7b97\u6cd5\u81ea\u5b9a\u4e49");if(d.include("iPhone")){a.push("\u4e0a\u6d77\u4ea4\u5927\u4fee\u4e1a\u67e5\u8be2");
e=false}else if(d.include("Android"))e=false}if(b)$("browser_warning").show().update("GPA\u8ba1\u7b97\u5668\u4e0d\u652f\u6301\u4f60\u7684\u6d4f\u89c8\u5668\uff0c\u8bf7\u4f7f\u7528\u517c\u5bb9\u7684\u6d4f\u89c8\u5668\uff1aFirefox3,IE8,IE7");else a.length>0&&$("browser_warning").show().update("GPA\u8ba1\u7b97\u5668\u4e0d\u5b8c\u5168\u652f\u6301\u4f60\u7684\u6d4f\u89c8\u5668\uff0c\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u7684\u529f\u80fd\uff1a"+a.join(",")+"\uff0c\u5efa\u8bae\u4f7f\u7528\u517c\u5bb9\u7684\u6d4f\u89c8\u5668\uff1aFirefox3,IE8,IE7");
e&&$("input_jAccount").update("\u4e0a\u6d77\u4ea4\u5927jAccount\u8f93\u5165\u65b9\u5f0f\u4ec5\u5bf9\u624b\u673aWML\u7248\u548ciPhone\u3001Android\u6d4f\u89c8\u5668\u5f00\u653e")};GPA.StepUI=function(a){$$(".step").invoke("hide");return $("step_"+a).show()};GPA.Restart=function(){if(confirm("\u91cd\u65b0\u5f00\u59cb\u5c06\u5220\u9664\u6240\u6709\u672a\u5bfc\u51fa\u6570\u636e\uff0c\u662f\u5426\u7ee7\u7eed\uff1f")){GPA.stat("core.Restart");GPA.StepUI("input_choose");GPA.Calc=new GPA.Calculator}};
GPA.stat=function(a){if(!GPA.stat.a.include(a)){GPA.stat.a.push(a);c(a)}};GPA.stat.a=[];GPA.LoadComponent.a.push("core");GPA.Input=function(a){GPA.stat("input-"+a+".start");GPA.Input.current_type=a;(GPA.Input.current=new GPA.Input[a]).start()};GPA.Input.Base=Class.create({start:function(){},get:function(){return null},alertInvalid:function(){alert("\u6ca1\u6709\u627e\u5230\u8bfe\u7a0b\u4fe1\u606f")}});
Object.extend(GPA.Input,{get:function(){return GPA.Input.current.get()},done:function(){var a=GPA.Input.get();if(!a||a.Count()<1)return GPA.Input.current.alertInvalid();GPA.stat("input-"+GPA.Input.current_type+".done");GPA.Calc.Courses=a;GPA.LoadComponent("algorithm");GPA.Algorithm.UI.start()},cancel:function(){GPA.StepUI("input_choose")}});
GPA.Input.SJTU=Class.create(GPA.Input.Base,{start:function(){GPA.showLoading();GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1a\u4e0a\u6d77\u4ea4\u5927\u4fee\u4e1a\u67e5\u8be2</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><p>\u8bbf\u95ee<a href="javascript:;" onclick="window.open(\'http://jwb.jwc.sjtu.edu.cn/xsbyshj/\');">\u672c\u79d1\u4fee\u4e1a\u60c5\u51b5\u67e5\u8be2</a>\uff0c\u7528\u4f60\u7684jAccount\u767b\u5f55(\u7528\u6237\u540d\u5bc6\u7801\u4e0e\u4ea4\u5927\u90ae\u7bb1\u3001portal\u4e2a\u4eba\u5b58\u50a8FTP\u76f8\u540c)\u3002\u51fa\u73b0\u7ed3\u679c\u540e\uff0c\u6309\u4e0bCTRL+A\u952e\u5168\u9009\uff0c\u6309\u4e0bCTRL+C\u952e\u590d\u5236\uff0c\u7136\u540e\u70b9\u51fb\u4e0b\u9762\u7684\u6587\u672c\u6846\u3001\u6309\u4e0bCTRL+V\u952e\u7c98\u8d34\u3002</p>'+(GPA.xiaonei_app?
'<iframe src="input-sjtu.htm" width="720" height="200" scrolling="no" frameborder="0" marginheight="0" marginwidth="0" border="0"></iframe>':'<iframe src="input-sjtu.htm" width="800" height="200" scrolling="no" frameborder="0" marginheight="0" marginwidth="0" border="0"></iframe>')+'<p>\u7c98\u8d34\u5b8c\u6bd5\u540e\uff0c<a href="javascript:GPA.Input.done();">\u7ee7\u7eed</a></p>')}});
GPA.Input.jAccount=Class.create(GPA.Input.Base,{start:function(){GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1a\u4e0a\u6d77\u4ea4\u5927jAccount</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><p>jAccount\u5e10\u53f7<input id="GPA_input_jAccount_u" type="text"/> \u5bc6\u7801<input id="GPA_input_jAccount_p" type="password"/> <input type="button" value="\u63d0\u53d6\u6210\u7ee9\u4fe1\u606f" onclick="GPA.Input.current.fetch();"/></p><p>jAccount\u5e10\u53f7\u5c31\u662f\u4f60\u7684\u4ea4\u5927\u90ae\u7bb1\u5730\u5740@\u4e4b\u524d\u7684\u90e8\u5206\uff0c\u6216portal\u4e2a\u4eba\u5b58\u50a8\u7684\u7528\u6237\u540d\u3002<br/>\u9633\u5149GPA\u8ba1\u7b97\u5668\u4e0d\u4f1a\u8bb0\u5f55\u4f60\u7684jAccount\u548c\u5176\u4ed6\u4e2a\u4eba\u8d44\u6599\u3002<br/>\u5982\u679c\u4f60\u4e0d\u613f\u610f\u5728\u6b64\u8f93\u5165jAccount\u5e10\u53f7\uff0c\u8bf7\u4f7f\u7528<a href="javascript:GPA.Input(\'SJTU\')">\u4e0a\u6d77\u4ea4\u5927\u4fee\u4e1a\u67e5\u8be2</a>\u8f93\u5165\u65b9\u5f0f\u3002')},fetch:function(){GPA.stat("input-jAccount.fetch");
this.data=null;var a=$F("GPA_input_jAccount_u"),b=$F("GPA_input_jAccount_p");WebSite.loadJS(null,"https://yoursunny-app.appspot.com/study/GPA/json?"+Object.toQueryString({u:a,p:b,cb:"GPA.Input.current.callback"}))},callback:function(a){this.data=a;GPA.Input.done()},data:null,get:function(){if(!this.data)return null;var a=new GPA.CourseCollection;this.data.each(function(b){var d=new GPA.Course;d.code=b.code;d.name=b.name;d.credit=b.credit;d.grade=b.grade;d.selected=[0,1].include(b.type);a.Add(d)});
return a},alertInvalid:function(){alert("\u6ca1\u6709\u627e\u5230\u8bfe\u7a0b\u4fe1\u606f\uff0c\u8bf7\u68c0\u67e5\u5e10\u53f7\u3001\u5bc6\u7801\u662f\u5426\u6b63\u786e")}});
GPA.Input.Table=Class.create(GPA.Input.Base,{start:function(){GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1a\u8868\u683c\u5f55\u5165</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><p>\u63d0\u793a\uff1a\u5b66\u5206\u3001\u6210\u7ee9\u5fc5\u987b\u5f55\u5165\uff0c\u8bfe\u7a0b\u540d\u79f0\u53ef\u4ee5\u7559\u7a7a\uff1b\u5982\u9700\u5220\u9664\u4e00\u95e8\u8bfe\u7a0b\uff0c\u53ea\u9700\u5c06\u5b66\u5206\u6216\u6210\u7ee9\u7559\u7a7a</p><table id="InputTable"><tr><th>\u8bfe\u7a0b\u540d\u79f0</th><th>\u5b66\u5206</th><th>\u6210\u7ee9</th></tr>'+this.input_course.times(10)+
'</table><p><a href="javascript:GPA.Input.current.more();">\u5f55\u5165\u66f4\u591a\u8bfe\u7a0b\u4fe1\u606f</a>\uff1b\u5f55\u5165\u5b8c\u6bd5\u540e\uff0c<a href="javascript:GPA.Input.done();">\u7ee7\u7eed</a></p>')},startAsEditor:function(a,b){var d="";a.each(function(e,f){d+='<tr id="InputTable_c%4" class="InputTable_course%5"><td><input type="text" value="%1"/></td><td><input type="text" value="%2"/></td><td><input type="text" value="%3"/></td></tr>'.format(f.name,f.credit,f.grade,e,f.selected?
"":" InputTable_noselect")});GPA.StepUI("input").update('<h2>\u7f16\u8f91\u8bfe\u7a0b\u4fe1\u606f</h2><p>\u5982\u9700\u5220\u9664\u4e00\u95e8\u8bfe\u7a0b\uff0c\u53ea\u9700\u5c06\u5b66\u5206\u6216\u6210\u7ee9\u7559\u7a7a</p><table id="InputTable"><tr><th>\u8bfe\u7a0b\u540d\u79f0</th><th>\u5b66\u5206</th><th>\u6210\u7ee9</th></tr>'+d+'</table><p><a href="javascript:GPA.Input.current.more();">\u5f55\u5165\u66f4\u591a\u8bfe\u7a0b\u4fe1\u606f</a>\uff1b\u5f55\u5165\u5b8c\u6bd5\u540e\uff0c<a href="javascript:;" id="InputTable_OK">\u7ee7\u7eed</a></p>');
Event.observe.defer("InputTable_OK","click",b?b:GPA.Input.done)},more:function(){$("InputTable").insert(this.input_course.times(5))},get:function(){var a=new GPA.CourseCollection;$$("#InputTable tr.InputTable_course").each(function(b){var d=function(h){return b.select("input")[h].value.strip()},e=d(1),f=d(2);if(!(e==""||f=="")){e=parseFloat(e,10);f=parseInt(f,10);if(!(isNaN(e)||isNaN(f))){var g=new GPA.Course;if(b.id&&b.id.startsWith("InputTable_c"))g.id=b.id.substr(12);g.name=d(0);g.credit=e;g.grade=
f;if(b.hasClassName("InputTable_noselect"))g.selected=false;a.Add(g)}}});return a},input_course:'<tr class="InputTable_course"><td><input type="text"/></td><td><input type="text"/></td><td><input type="text"/></td></tr>'});
GPA.Input.CSV=Class.create(GPA.Input.Base,{start:function(){GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1aCSV/TXT\u6587\u4ef6\u4e0a\u4f20</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><form enctype="multipart/form-data" action="input-csv.php" method="POST" target="input_csv_frame">\u9009\u62e9CSV/TXT\u6587\u4ef6\uff1a<input name="u" type="file" /> <input type="submit" value="\u4e0a\u4f20" /></form><p>CSV\u6216TXT\u6587\u4ef6\u9700\u4e3aANSI\u6216GBK\u7f16\u7801\uff0c\u6bcf\u884c\u5305\u542b\u8bfe\u7a0b\u540d\u79f0(\u53ef\u9009)\u3001\u6210\u7ee9\u3001\u5b66\u5206\uff0c\u7528\u7a7a\u683c\u6216\u82f1\u6587\u9017\u53f7\u9694\u5f00\uff0c\u6837\u4f8b\uff1a</p><blockquote>\u9ad8\u7b49\u6570\u5b66 70 5<br/>96 2.5<br/>\u5927\u5b66\u7269\u7406 68 4<br/>82 1.0<br/></blockquote><p>\u5bfc\u5165\u540e\uff0c\u5982\u679c\u53d1\u73b0\u90e8\u5206\u8bfe\u7a0b\u4fe1\u606f\u6709\u8bef\uff0c\u8bf7\u5728\u8ba1\u7b97\u7ed3\u679c\u9875\u9762\u70b9\u51fb\u9876\u90e8\u201c\u7f16\u8f91\u8bfe\u7a0b\u4fe1\u606f\u201d\uff1b<br/>\u6ce8\u610f\uff1a\u6210\u7ee9\u5fc5\u987b\u662f\u6574\u6570\uff0c\u5b66\u5206\u5728\u6210\u7ee9\u540e\u9762</p><iframe id="input_csv_frame" name="input_csv_frame" width="1" height="1" style="display:none;"></iframe><p>\u58f0\u660e\uff1aCSV/TXT\u4e0a\u4f20\u9700\u8981\u63d0\u4ea4\u6587\u4ef6\u5185\u5bb9\u5230\u670d\u52a1\u5668\uff1byoursunny.com\u627f\u8bfa\u4e0d\u5b58\u50a8\u60a8\u7684\u4fe1\u606f\u3002<br/>\u7ee7\u7eed\u64cd\u4f5c\u8868\u793a\u4f60\u8ba4\u540c\u4e0a\u8ff0\u58f0\u660e\u3002</p>')},get:function(){var a=
new GPA.CourseCollection;a.AddRange(this.getJSON().evalJSON().collect(function(b){return Object.extend(new GPA.Course,b)}));return a}});GPA.Input.XHTML=Class.create(GPA.Input.Base,{start:function(){GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1aXHTML\u6587\u4ef6\u4e0a\u4f20</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><form enctype="multipart/form-data" action="input-xhtml.php" method="POST" target="input_xhtml_frame">\u9009\u62e9\u4e0a\u6b21\u5bfc\u51fa\u7684XHTML\u6587\u4ef6\uff1a<input name="u" type="file" /> <input type="submit" value="\u4e0a\u4f20" /></form><iframe id="input_xhtml_frame" name="input_xhtml_frame" width="1" height="1" style="display:none;"></iframe><p>\u58f0\u660e\uff1aXHTML\u4e0a\u4f20\u9700\u8981\u63d0\u4ea4\u6587\u4ef6\u5185\u5bb9\u5230\u670d\u52a1\u5668\uff1byoursunny.com\u627f\u8bfa\u4e0d\u5b58\u50a8\u60a8\u7684\u4fe1\u606f\u3002<br/>\u7ee7\u7eed\u64cd\u4f5c\u8868\u793a\u4f60\u8ba4\u540c\u4e0a\u8ff0\u58f0\u660e\u3002</p>')}});
GPA.Input.JSON=Class.create(GPA.Input.Base,{start:function(){GPA.StepUI("input").update('<h2>\u8f93\u5165\u8bfe\u7a0b\u4fe1\u606f\uff1aJSON\u5bfc\u5165</h2><p><a href="javascript:GPA.Input.cancel();">\u9009\u62e9\u5176\u4ed6\u8f93\u5165\u65b9\u5f0f</a></p><p>\u8bf7\u7c98\u8d34\u4e0a\u6b21\u5bfc\u51fa\u7684JSON\u4ee3\u7801\uff0c\u4ee3\u7801\u4e0d\u80fd\u4fee\u6539\u3002</p><textarea id="input_json"></textarea><p>\u7c98\u8d34\u5b8c\u6bd5\u540e\uff0c<a href="javascript:GPA.Input.done();">\u7ee7\u7eed</a></p>')},
get:function(){var a;try{a=$F("input_json").evalJSON()}catch(b){return null}var d=new GPA.CourseCollection;d.AddRange(a);return d},alertInvalid:function(){alert("\u7c98\u8d34\u7684JSON\u6570\u636e\u4e0d\u5b8c\u6574\u3002\u8bf7\u52ff\u4fee\u6539\u4ee3\u7801\uff0c\u5426\u5219\u4e0d\u80fd\u8bc6\u522b\u3002")}});GPA.LoadComponent.a.push("input");
GPA.Algorithm.RangeMap=Class.create(GPA.Algorithm,{map:null,initialize:function(){var a=Number.POSITIVE_INFINITY,b=$A(arguments);this.name=b.shift();this.map=b.eachSlice(2,function(d){var e=new GPA.Algorithm.RangeMap.Entry(d[1],a,d[0]);a=d[1];return e})},p:function(a){var b=0;this.map.each(function(d){if(d.range.include(a)){b=d.point;throw $break;}});return b},ToJS:function(){return"(new GPA.Algorithm.RangeMap("+this.name.inspect()+","+this.map.collect(function(a){return[a.point,a.range.start].join(",")}).join(",")+
"))"},canEdit:true,Viewer:function(a){$(a).update("<table><caption>"+this.name.encodeHTML()+"</caption><tr><th>\u6210\u7ee9</th><th>\u7ee9\u70b9</th></tr>"+this.map.collect(function(b){return"<tr><td>%2 ~ %3</td><td>%1</td></tr>".format(b.point,b.range.start,isFinite(b.range.end)?b.range.end:"")}).join("")+"</table>")},Editor:function(a){$(a).update('<table><tr class="AlgorithmEditor_h"><th>\u6210\u7ee9\u2265</th><th>\u7ee9\u70b9</th><th>\u64cd\u4f5c</th></tr>'+this.map.collect(function(b){return'<tr><td><input type="text" class="AlgorithmEditor_grade" value="%2"/></td><td><input type="text" class="AlgorithmEditor_point" value="%1"/></td><td><input type="button" class="AlgorithmEditor_del" value="\u5220\u9664"/></td></tr>'.format(b.point,
b.range.start)}).join("")+'<tr><td><input type="text" class="AlgorithmEditor_grade" value=""/></td><td><input type="text" class="AlgorithmEditor_point" value=""/></td><td><input type="button" class="AlgorithmEditor_ins" value="\u63d2\u5165"/></td></tr></table>');(function(){var b=function(d){var e=Event.element(d);d=Event.findElement(d,"tr");if(!(!d||d==document))if(e.hasClassName("AlgorithmEditor_ins")){$(e).removeClassName("AlgorithmEditor_ins").addClassName("AlgorithmEditor_del").value="\u5220\u9664";
$(d).insert({after:'<tr><td><input type="text" class="AlgorithmEditor_grade" value=""/></td><td><input type="text" class="AlgorithmEditor_point" value=""/></td><td><input type="button" class="AlgorithmEditor_ins" value="\u63d2\u5165"/></td></tr>'});(function(){$(a).select(".AlgorithmEditor_ins").invoke("observe","click",b)}).defer()}else $(d).remove()};$(a).select(".AlgorithmEditor_del",".AlgorithmEditor_ins").invoke("observe","click",b)}).defer()},EditorSave:function(a,b){b=new GPA.Algorithm.RangeMap(b);
var d=Number.POSITIVE_INFINITY;b.map=$(a).select("tr:not(.AlgorithmEditor_h)").collect(function(e){var f=parseFloat(e.select(".AlgorithmEditor_point").first().value,10);e=parseInt(e.select(".AlgorithmEditor_grade").first().value,10);if(isNaN(f)||isNaN(e))return null;return[f,e]}).compact().sortBy(function(e){return e.grade}).collect(function(e){var f=new GPA.Algorithm.RangeMap.Entry(e[1],d,e[0]);d=e[1];return f});return b}});
GPA.Algorithm.RangeMap.Entry=Class.create({range:null,point:0,initialize:function(a,b,d){this.range=$R(a,b,true);this.point=d}});GPA.Algorithm.ArithmeticMap=Class.create(GPA.Algorithm,{initialize:function(a,b,d,e){this.name=a;this.p=b;this.ToJS=function(){return d};this.Viewer=function(f){$(f).update(a+"<hr/>"+e)}}});
GPA.Algorithm.Predefined={SJTU:new GPA.Algorithm.RangeMap("\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66",4.3,95,4,90,3.7,85,3.3,80,3,75,2.7,70,2.3,67,2,65,1.7,62,1,60,0,0),US1:new GPA.Algorithm.RangeMap("\u7f8e\u56fd1",4,90,3,80,2,70,1,60,0,0),US2:new GPA.Algorithm.RangeMap("\u7f8e\u56fd2",4,90,3.5,85,3,80,2.5,75,2,70,1.5,65,1,60,0,0),US3:new GPA.Algorithm.RangeMap("\u7f8e\u56fd3",4,90,3.7,87,3.3,83,3,80,2.7,77,2.3,73,1.7,70,1,60,0,0),PKU:new GPA.Algorithm.RangeMap("\u5317\u4eac\u5927\u5b66\uff082006\u7ea7\u53ca\u4e4b\u524d\uff09",
4,90,3.7,85,3.3,82,3,78,2.7,75,2.3,72,2,68,1.5,64,1,60,0,0),Canada:new GPA.Algorithm.RangeMap("\u52a0\u62ff\u5927",4.3,90,4,85,3.7,80,3.3,75,3,70,2.7,65,2.3,60,0,0),ZJU:new GPA.Algorithm.ArithmeticMap("\u6d59\u6c5f\u5927\u5b66",function(a){if(a>=85)return 4;if(a<60)return 0;return 1.5+(a-60)/10},"GPA.Algorithm.Predefined.ZJU","85 ~ 100 =&gt; 4.0<br/>60 ~ 84 =&gt; 1.5 ~ 3.9\uff08\u5206\u6570\u6bcf\u9ad81\u5206GPA\u589e\u52a00.1\u5206\uff09"),PKU7:new GPA.Algorithm.ArithmeticMap("\u5317\u4eac\u5927\u5b66\uff082007\u7ea7\u53ca\u4e4b\u540e\uff09",
function(a){if(a<60)return 0;return((4-3*(100-a)*(100-a)/1600)*100).round()/100},"GPA.Algorithm.Predefined.PKU7","0 ~ 59 =&gt; 0<br/>60 ~ 100 =&gt; 4-3*(100-X)<sup>2</sup>/1600"),FUDAN:new GPA.Algorithm.RangeMap("\u590d\u65e6\u5927\u5b66",4,90,3.7,85,3.3,82,3,78,2.7,75,2.3,71,2,66,1.7,62,1.3,60,0,0),SHU:new GPA.Algorithm.RangeMap("\u4e0a\u6d77\u5927\u5b66",4,90,3.7,85,3.3,82,3,78,2.7,75,2.3,72,2,68,1.7,66,1.5,64,1,69,0,0)};
GPA.Algorithm.CookieSave={CookieName:"GPA_Algorithm_Saved",Read:function(){var a=Cookie.get(GPA.Algorithm.CookieSave.CookieName);if(!a)return[];try{return eval(a)}catch(b){Cookie.erase(GPA.Algorithm.CookieSave.CookieName);return[]}},Write:function(a){Cookie.set(GPA.Algorithm.CookieSave.CookieName,"["+a.invoke("ToJS").join(",")+"]",60)},Add:function(a){var b=GPA.Algorithm.CookieSave.Read();b.unshift(a);b.length>15&&b.splice(15,b.length-15);GPA.Algorithm.CookieSave.Write(b)}};
GPA.Algorithm.UI={start:function(){GPA.Algorithm.UI.CookieSaveAlgorithms=GPA.Algorithm.CookieSave.Read();var a=function(b,d,e){return'<li onmouseover="GPA.Algorithm.UI.Choose%1(%2,2)"><input type="button" onclick="GPA.Algorithm.UI.Choose%1(%2,0);" value="\u9009\u7528"/> <input type="button" onclick="GPA.Algorithm.UI.Choose%1(%2,1);" value="\u4fee\u6539"%4/> <a href="javascript:GPA.Algorithm.UI.Choose%1(%2,0);">%3</a></li>'.format(b,d,e.name.encodeHTML(),e.canEdit?"":' disabled="disabled"')};GPA.StepUI("algorithm").update('<p>\u8bf7\u9009\u62e9GPA\u7b97\u6cd5</p><div id="algorithm_view" class="f-right"></div><ul>'+
Object.keys(GPA.Algorithm.Predefined).collect(function(b){return a("Predefined",b.inspect(),GPA.Algorithm.Predefined[b])}).join("")+GPA.Algorithm.UI.CookieSaveAlgorithms.collect(function(b,d){return a("CookieSave",d,b)}).join("")+'<li><a href="javascript:GPA.Algorithm.UI.CreateCustom();">\u521b\u5efa\u81ea\u5b9a\u4e49\u7b97\u6cd5</a></li></ul>')},CookieSaveAlgorithms:null,ChoosePredefined:function(a,b){b==0&&GPA.stat("algorithm-"+a+".choose");b==1&&GPA.stat("algorithm-"+a+".edit");GPA.Algorithm.UI.ChooseAlgorithm(GPA.Algorithm.Predefined[a],
b)},ChooseCookieSave:function(a,b){b==0&&GPA.stat("algorithm-custom.choose");b==1&&GPA.stat("algorithm-custom.edit");GPA.Algorithm.UI.ChooseAlgorithm(GPA.Algorithm.UI.CookieSaveAlgorithms[a],b)},CreateCustom:function(){GPA.stat("algorithm-custom.create");GPA.Algorithm.UI.current=new GPA.Algorithm.RangeMap("\u65b0\u5efa\u81ea\u5b9a\u4e49\u7b97\u6cd5");GPA.Algorithm.UI.Editor()},current:null,ChooseAlgorithm:function(a,b){GPA.Algorithm.UI.current=a;switch(b){case 0:GPA.Algorithm.UI.Done();break;case 1:GPA.Algorithm.UI.Editor();
break;case 2:GPA.Algorithm.UI.Viewer();break}},Viewer:function(){GPA.Algorithm.UI.current.Viewer("algorithm_view")},Editor:function(){$("step_algorithm").update('<p>GPA\u7b97\u6cd5\uff1a<input type="text" id="AlgorithmEditor_name" value="'+GPA.Algorithm.UI.current.name.encodeHTML()+"#"+(Math.random()*1024).floor()+'"/></p><div id="AlgorithmEditor_t"></div><p><input type="button" onclick="GPA.Algorithm.UI.EditDone();" value="\u4fdd\u5b58\u5e76\u7ee7\u7eed"/> <a href="javascript:GPA.Algorithm.UI.start();">\u53d6\u6d88\u7f16\u8f91</a></p>');
GPA.Algorithm.UI.current.Editor.bind(GPA.Algorithm.UI.current,"AlgorithmEditor_t").defer()},EditDone:function(){var a=GPA.Algorithm.UI.current.EditorSave("AlgorithmEditor_t",$F("AlgorithmEditor_name"));GPA.stat("algorithm.editor-save");GPA.Algorithm.CookieSave.Add(a);GPA.Algorithm.UI.current=a;GPA.Algorithm.UI.Done()},Done:function(){GPA.Calc.Algorithm=GPA.Algorithm.UI.current;GPA.LoadComponent("calc");GPA.Calc.UIstart()}};GPA.LoadComponent.a.push("algorithm");
GPA.Calculator.addMethods({updatePoint:function(){var a=this.Algorithm;this.Courses.each(function(b,d){d.point=a.p(d.grade);d.cp=d.credit*d.point})},calcGPA:function(a){var b=0,d=0,e=0,f=this.Courses,g=function(h,i){b+=i.credit;d+=i.cp;e+=i.grade*i.credit};if(a){f=f.Selected();g=g.curry(-1)}f.each(g);return{selected_only:a,credit:b,cp:d,grade:b==0?0:e/b,gpa:b==0?0:d/b,count:f.length}}});
Number.prototype.Round1=function(){var a=(this*10).round().toPaddedString(2,10);return a.substr(0,a.length-1)+"."+a.substr(a.length-1)};Number.prototype.Round4=function(){var a=(this*1E4).round().toPaddedString(5,10);return a.substr(0,a.length-4)+"."+a.substr(a.length-4)};
GPA.Calculator.addMethods({UIstart:function(){this.updatePoint();GPA.StepUI("calc").update('<h2>GPA\u8ba1\u7b97\u7ed3\u679c\uff1a<span id="calc_resultGPA"></span></h2><p>\u5f53\u524d\u7b97\u6cd5\uff1a'+this.Algorithm.name.encodeHTML()+' <a href="javascript:;" onclick="GPA.StepUI(\'algorithm\')">\u66f4\u6362\u7b97\u6cd5</a></p><div id="calc_result"></div><div id="calc_table"></div><ul><li><a href="javascript:GPA.Calc.startEditor();GPA.stat(\'calc.edit-course\');">\u7f16\u8f91\u8bfe\u7a0b\u4fe1\u606f</a> \u5728\u8868\u683c\u4e2d\u4fee\u6539\u5b66\u5206\u3001\u6210\u7ee9\u7b49\u8bfe\u7a0b\u4fe1\u606f</li>'+
(this.Translator?"":'<li id="calc_translate"><a href="javascript:GPA.Calc.Translate()">\u7ffb\u8bd1\u8bfe\u7a0b\u540d\u79f0</a> \u5c06\u8bfe\u7a0b\u540d\u79f0\u7ffb\u8bd1\u6210\u82f1\u6587</li>')+"<li><a href=\"javascript:GPA.Calc.Export('xhtml')\">\u5bfc\u51faXHTML</a> \u5c06\u8bfe\u7a0b\u4fe1\u606f\u548c\u8ba1\u7b97\u7ed3\u679c\u5bfc\u51fa\u6210XHTML\u683c\u5f0f\uff0c\u4ee5\u4fbf\u79bb\u7ebf\u67e5\u770b\u6216\u7f16\u7a0b\u5206\u6790</li><li><a href=\"javascript:GPA.Calc.Export('json')\">\u5bfc\u51faJSON</a> \u5c06\u8bfe\u7a0b\u4fe1\u606f\u5bfc\u51fa\u6210JSON\u683c\u5f0f\uff0c\u4e0b\u6b21\u4f7f\u7528\u9633\u5149GPA\u8ba1\u7b97\u5668\u65f6\u53ef\u4ee5\u5bfc\u5165</li></ul>");
(function(){this.updateTable();this.updateResult()}).bind(this).defer();if(GPA.xiaonei_app&&!GPA.xiaonei_app_minifeed){GPA.xiaonei_app_minifeed=true;new Ajax.Request("xiaonei-minifeed.php",{parameters:location.search.substr(1)})}},UIshow:function(){GPA.StepUI("calc")},startEditor:function(){GPA.Input.current=new GPA.Input.Table;GPA.Input.current.startAsEditor(this.Courses,function(){this.Courses=GPA.Input.get();this.UIstart()}.bind(this))},updateTable:function(){var a=this.Translator,b="<table><tr><th>&nbsp;</th><th>\u8bfe\u7a0b\u540d\u79f0</th>"+
(a?"<th>\u82f1\u6587\u540d\u79f0</th>":"")+"<th>\u6210\u7ee9</th><th>\u5b66\u5206</th><th>\u7ee9\u70b9</th><th>\u5b66\u5206\u00d7\u7ee9\u70b9</th></tr>",d='<tr id="calc_course_%1"><td><input type="checkbox" id="calc_select_%1" %2 on'+(Prototype.Browser.IE?"click":"change")+'="GPA.Calc.clickSelect(%1)"/></td><td>%3</td>'+(a?"<td>%8</td>":"")+"<td>%5</td><td>%4</td><td>%6</td><td>%7</td></tr>";this.Courses.each(function(e,f){b+=d.format(e,f.selected?' checked="checked"':"",f.name.encodeHTML(),f.credit,
f.grade,f.point,f.cp.Round1(),a?a.Translate(f.name).encodeHTML():"")});b+="</table>";$("calc_table").update(b)},updateResult:function(a){a||(a=this.calcGPA(true));var b=a.gpa.Round4(),d=a.grade.Round1();$("calc_result").update("%1\u95e8\u8bfe\u7a0b\uff0c\u603b\u5b66\u5206=%2\uff0c\u52a0\u6743\u5e73\u5747\u6210\u7ee9=%3\uff0cGPA=%4".format(a.count,a.credit,d,b));$("calc_resultGPA").update(b)},clickSelect:function(a){this.Courses.Select(a,$("calc_select_"+a).checked);this.updateResult();GPA.stat("calc.click-select")},
Translate:function(){GPA.LoadComponent("translator");$("calc_translate").remove();this.Translator=new GPA.Translator;this.Translator.onUpdate=this.TranslateUpdate.bind(this);this.Translator.PrepareCourseCollection(this.Courses)},TranslateUpdateDelay:0,TranslateUpdate:function(){window.clearTimeout(this.TranslateUpdateDelay);this.TranslateUpdateDelay=this.updateTable.bind(this).defer()},Export:function(a){GPA.LoadComponent("export");switch(a){case "xhtml":GPA.Export.XHTML(this);break;case "json":GPA.Export.JSON(this);
break}}});GPA.LoadComponent.a.push("calc");GPA.Export={};
GPA.Export.XHTML=function(a){GPA.stat("export-XHTML.start");var b=a.Translator;b||(b={Translate:function(){return""}});var d="",e=function(g){d+=g+"\r\n"};e('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">');e('<html xmlns="http://www.w3.org/1999/xhtml">');e("<head>");e('<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />');e("<title>\u9633\u5149GPA\u8ba1\u7b97\u5668 - \u4f60\u7684\u9633\u5149\u5b66\u4e60\u9891\u9053 study.yoursunny.com</title>");e('<style type="text/css">/*<![CDATA[*/');
e("table { border-left:solid 1px #9cf; border-top:solid 1px #9cf; border-collapse:collapse; }");e("th,td { border-right:solid 1px #9cf; border-bottom:solid 1px #9cf; }");e("/*]]\>*/</style>");e("</head><body>");e("<h1>\u9633\u5149GPA\u8ba1\u7b97\u5668 - XHTML\u62a5\u8868</h1>");e("<div>\u7b97\u6cd5\uff1a"+a.Algorithm.name.encodeHTML());e('<div id="algorithm" style="display:none;">'+a.Algorithm.ToJS().encodeHTML()+"</div>");e("</div>");e("<div>\u8ba1\u7b97\u7ed3\u679c\uff1a");var f=a.calcGPA(true);
e("%1\u95e8\u8bfe\u7a0b\uff0c\u603b\u5b66\u5206=%2\uff0cGPA=%3".format(f.count,f.credit,f.gpa.Round4()));e("</div>");e("<table>");e("<tr><th>\u9009\u4e2d</th><th>\u8bfe\u7a0b\u540d\u79f0</th><th>\u82f1\u6587\u540d\u79f0</th><th>\u6210\u7ee9</th><th>\u5b66\u5206</th><th>\u7ee9\u70b9</th><th>\u5b66\u5206\u00d7\u7ee9\u70b9</th></tr>");a.Courses.each(function(g,h){e('<tr id="course_%1"><td>%2</td><td>%3</td><td>%8</td><td>%5</td><td>%4</td><td>%6</td><td>%7</td></tr>'.format(g,h.selected?"1":"0",h.name.encodeHTML(),
h.credit,h.grade,h.point,h.cp.Round1(),b.Translate(h.name)))});e("</table>");e('<p>\u6b22\u8fce\u60a8\u518d\u6b21\u4f7f\u7528<a href="http://yoursunny.com/study/GPA/">\u9633\u5149GPA\u8ba1\u7b97\u5668</a>\u3002</p>');e("</body></html>");GPA.StepUI("export").update('<h2>XHTML\u5bfc\u51fa</h2><p>\u58f0\u660e\uff1aXHTML\u5bfc\u51fa\u9700\u8981\u63d0\u4ea4\u8bfe\u7a0b\u4fe1\u606f\u548c\u8ba1\u7b97\u7ed3\u679c\u5230\u670d\u52a1\u5668\uff1byoursunny.com\u627f\u8bfa\u4e0d\u5b58\u50a8\u60a8\u7684\u4fe1\u606f\u3002<br/>\u7ee7\u7eed\u64cd\u4f5c\u8868\u793a\u4f60\u8ba4\u540c\u4e0a\u8ff0\u58f0\u660e\u3002</p><iframe id="export_xhtml_frame" name="export_xhtml_frame" width="1" height="1" style="display:none;"></iframe><form action="export-xhtml.php" method="post" target="export_xhtml_frame" onsubmit="GPA.stat(\'export-XHTML.submit\');"><input type="hidden" name="x" id="export_xhtml_x"/><input type="submit" value="\u5bfc\u51fa\u62a5\u8868"/></form><p><a href="javascript:GPA.Calc.UIshow();">\u8fd4\u56de\u5230\u8ba1\u7b97\u7ed3\u679c</a></p>');
(function(){$("export_xhtml_x").value=d}).defer()};GPA.Export.JSON=function(a){GPA.stat("export-JSON.start");a=Object.toJSON(a.Courses.toArray().collect(function(b){return{id:b.id,name:b.name,credit:b.credit,grade:b.grade,code:b.code,selected:b.selected}}));GPA.StepUI("export").update("<h2>JSON\u5bfc\u51fa</h2><p>\u8bf7\u590d\u5236\u4e0b\u5217\u4ee3\u7801\u5e76\u59a5\u5584\u4fdd\u5b58\uff0c\u4ee3\u7801\u4e0d\u80fd\u4fee\u6539\u3002</p><textarea>"+a.encodeHTML()+'</textarea><p><a href="javascript:GPA.Calc.UIshow();">\u8fd4\u56de\u5230\u8ba1\u7b97\u7ed3\u679c</a></p>')};
GPA.LoadComponent.a.push("export");
GPA.Translator=Class.create({initialize:function(){this.H=$H();this.GoogleTranslatePending=[]},PrepareCourseCollection:function(a){GPA.stat("translator.prepare");var b=[];a.each(function(d,e){b.push(e.name)});new Ajax.Request("translator.php",{contentType:"text/plain",postBody:b.join("\n"),onComplete:this.PrepareResponse.bind(this)})},PrepareResponse:function(a){this.H=this.H.merge(a.responseJSON);(this.onUpdate||Prototype.emptyFunction)(Object.keys(a.responseJSON))},onUpdate:null,Translate:function(a,
b){a=a.strip();if(a=="")return"";var d=this.H.get(a);!d&&!b&&this.GoogleTranslate(a);return d?d:""},GoogleTranslatePending:null,GoogleTranslate:function(a){if(!this.GoogleTranslatePending.include(a)){if(this._GoogleTranslate)return this._GoogleTranslate(a);$("translator_google")==null&&$(document.body).insert('<iframe id="translator_google" src="translator-google.htm" width="1" height="1" style="display:none;"></iframe>');this.GoogleTranslate.bind(this,a).delay(1)}},GoogleTranslateCallback:function(a,
b){this.H.set(a,b);(this.onUpdate||Prototype.emptyFunction)([a]);GPA.stat("translator.google")},H:null});GPA.LoadComponent.a.push("translator");