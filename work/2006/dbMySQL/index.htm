<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>dbMySQL数据源访问类 (PHP) - 你的阳光技术频道 www.65536.cn</title>
<link rel="stylesheet" type="text/css" href="/images/9/" />
<script type="text/javascript" src="/lib/9.js?prettify"></script>
</head><body>

<div class="header">
<h2><a href="http://yoursunny.com/">你的阳光</a></h2>
<ul>
<li><a href="http://m.yoursunny.com/"><span>个人</span></a></li>
<li><a href="http://study.yoursunny.com/"><span>学习</span></a></li>
<li><a href="http://www.65536.cn/"><span>技术</span></a></li>
<li><a href="http://www.65536.cn/work/"><span>作品</span></a></li>
</ul>
<ol>
<li><a href="http://yoursunny.com/">你的阳光</a></li>
<li><a href="/">技术频道</a></li>
<li><a href="../../">作品</a></li>
<li><span>dbMySQL数据源访问类</span></li>
</ol>
</div>

<div class="content">

<div class="p"><div class="p-wrap">
<h1 class="tit">dbMySQL数据源访问类</h1>
<div class="p-body headers">

<p>dbMySQL类，用于PHP访问MySQL数据库，而编程更加方便、安全性更高。<br />
<a href="dbMySQL.zip" onclick="c('dbMySQL.zip')">下载dbMySQL</a></p>
<h3>dbMySQL优点</h3>
<ul>
<li>高安全性：强制检查类型、自动转义，避免SQL注入漏洞</li>
<li>方便编程：面向对象语法，不必写mysql_fetch_assoc等长长的函数名</li>
<li>方便编程：仿reader机制，直接从对象读出数据，不必再写$resultID</li>
<li>支持表名前缀：允许在一个数据库中运行多个应用</li>
</ul>
<h3>dbMySQL样例代码</h3>
<pre class="prettyprint lang-php">
&lt;?php
require_once 'dbMySQL.php';
$db=new dbMySQL('localhost','root','password','database','pr_',FALSE);

//插入记录
$db->execute('INSERT INTO ###statistics (t,ip) VALUES (NOW(),?ip)',array('ip'=>$_SERVER['REMOTE_ADDR']));
//实际执行 INSERT INTO pr_statistics (t,ip) VALUES (NOW(),'59.78.20.24')

//查询记录
$db->query('SELECT * FROM ###statistics ORDER BY t DESC LIMIT 0,?1n',array('1n'=>$_GET['n']));
//实际执行SELECT * FROM pr_statistics ORDER BY t DESC LIMIT 0,10

while (!$db->eof()) {
&nbsp;&nbsp;&nbsp;&nbsp;$row=$db->read();
&nbsp;&nbsp;&nbsp;&nbsp;echo $row['ip'].'&lt;br/&gt;';
}
?&gt;
</pre>
<h3>dbMySQL类库函数列表</h3>
<table border="1">
<caption>class dbMySQL</caption>
<tr><th>说明</th><th>定义</th><th>备注</th></tr>
<tr><td>构造函数</td><td>function __construct(主机名$host,用户名$username,密码$password,库名$dbname,表名前缀$prefix='',是否永久连接$pconnect=TRUE)</td><td>new dbMySQL(...)创建新对象</td></tr>
<tr><td>直接执行SQL语句</td><td>function execute_sql(语句$SQL)</td><td>无结果；不处理转义、表名前缀；无安全性，不推荐使用</td></tr>
<tr><td>执行SQL语句</td><td>function execute(语句$SQL,参数$p=NULL,表名前缀替代符$prefix='###')</td><td>无结果</td></tr>
<tr><td>直接执行SQL查询</td><td>function query_sql(语句$SQL)</td><td>有结果；不处理转义、表名前缀；无安全性，不推荐使用</td></tr>
<tr><td>执行SQL查询</td><td>function query(语句$SQL,参数$p=NULL,表名前缀替代符$prefix='###')</td><td>有结果</td></tr>
<tr><td>提取结果</td><td>function read()</td><td>提取一行结果为关联数组；已提取完时返回NULL</td></tr>
<tr><td>总行数</td><td>function num_rows()</td><td>返回刚才的语句影响行数、或查询结果行数</td></tr>
<tr><td>是否提取完</td><td>function eof()</td><td>如果已提取完返回true</td></tr>
</table>
<h4>带参数执行、查询说明</h4>
<p>数组$p "a"->"ppp"<br />
<code class="prettyprint lang-sql">SELECT * FROM j WHERE m=?a</code> 解析为 <code class="prettyprint lang-sql">SELECT * FROM j WHERE m='ppp'</code><br />
参数名称第一位是小写字母，作为字符型参数，编码并加单引号<br />
参数名称第一位是数字，作为数字型参数，如果不是数字就出错<br />
参数名称第一位是其他情况，直接带入SQL表达式<br />
$prefix表示前缀占位符，默认###，FROM ###kk在前缀是pr_时解析为FROM pr_kk</p>

</div></div></div>

</div>

<div class="footer">
<p class="copyright">&copy;2006-2009 yoursunny.com, CreativeCommons BY-NC 3.0</p>
<ul class="links">
<li><a href="http://yoursunny.com/m/about.htm">关于本站</a></li>
<li><a href="http://yoursunny.com/m/contact.htm">联系方式</a></li>
<li><a href="http://yoursunny.com/m/sitemap.htm">网站地图</a></li>
</ul>
</div>

</body></html>
