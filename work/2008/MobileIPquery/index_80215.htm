<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>手机号码IP地址归属地查询 (PHP) - 你的阳光技术频道</title>
<link rel="stylesheet" type="text/css" href="../../../images/yoursunny.css" />
<script type="text/javascript" src="../../../lib/lib.js.php"></script>
<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAihENVS8xCSR18JFDkoNVLhQeQHHT99Gc6LfE5Sc_D83CJnXdwhRDK9hRyd-kAuMdQ2xTc0a_fohGiw"></script>
</head>
<body><div id="container">

<div id="header">
<h2><a href="http://yoursunny.com"><span>你的阳光 yoursunny.com</span></a></h2>
<ul id="nav-header">
<li><a href="http://yoursunny.com">首页</a></li>
<li><a href="http://m.yoursunny.com">个人</a></li>
<li><a href="http://www.65536.cn">技术</a></li>
<li><a href="http://study.yoursunny.com">学习</a></li>
</ul>
</div>
<div id="sub-nav"><ul>
<li><a href="http://www.65536.cn">你的阳光技术频道 www.65536.cn</a></li>
<li class="mark">&raquo;</li>
<li><a href="../../">作品</a></li>
<li class="mark">&raquo;</li>
<li><a href="./">手机号码IP地址归属地查询</a></li>
</ul></div>

<div class="b">
<h2 class="bh">手机号码IP地址归属地查询</h2>
<table class="p">
<tr>
<td class="pcont">
<h1 class="ptitle">手机号码IP地址归属地查询</h1>
<div class="pmsg">
<p>一个PHP脚本，用于查询手机号码、IPv4地址的归属地。<br />
只依赖fsockopen函数（要求allow_url_fopen），不需要任何PHP扩展。<br />
数据来源：移动、联通、纯真IP库，均为直接在线查询，不使用数据库。<br />
<a href="query.zip" onclick="c('/work/2008/MobileIPquery/query.zip')">下载手机号码IP地址归属地查询PHP脚本</a></p>
<p>效果演示：</p>
<div>
<script type="text/javascript">
function run_demo(q)
{
	new Ajax.Request('query.php',{method:'get',parameters:{q:q},onComplete:show_demo});
	$('demo_input').value=q;
	$('demo_output').update('正在查询，请稍候；查询耗时较长，约需15秒');
}
function show_demo(resp)
{
	var d=resp.responseJSON;
	var b=''
	switch (d.type)
	{
		case 'mobile':
			b+='查询类型type：手机归属地mobile<br/>';
			switch (d.company)
			{
				case 'cmcc':
					b+='通讯公司company：中国移动cmcc<br/>省份province：'+d.province+'<br/>城市city：'+d.city+'<br/>';
					break;
				case 'unicom':
					b+='通讯公司company：中国联通unicom<br/>';
					break;
			}
			break;
		case 'ip':
			b+='查询类型type：IP地址ip<br/>IP地址ip：'+d.ip+'<br/>';
			break;
	}
	b+='查询结果result：'+d.result;
	$('demo_output').update(b);
}
</script>
<input id="demo_input" type="text" value="www.65536.cn" /><input type="button" value="查询" onclick="run_demo($F('demo_input'))" />
<div id="demo_output"></div>
</div>
<p><b>调用方法</b>：通常使用AJAX调用<br />
输入：query.php?q=要查询的11位手机号码或IP地址或域名<br />
输出：JSON格式，<br />
{<br />
&nbsp;&nbsp;type:查询类型，mobile或ip<br />
&nbsp;&nbsp;(手机号码)company:通讯公司，cmcc或unicom，不支持其他公司<br />
&nbsp;&nbsp;(移动手机)province:省份<br />
&nbsp;&nbsp;(移动手机)city:城市<br />
&nbsp;&nbsp;(IP/域名)ip:IP地址<br />
&nbsp;&nbsp;result:查询结果<br />
}</p>
</div>
</td>
<td class="pside">
<p>当前版本号：<br />
2008-02-15</p>
<p>查询举例：</p>
<ul id="l_demos">
<li onclick="run_demo('15802110000')">15802110000</li>
<li onclick="run_demo('13156980000')">13156980000</li>
<li onclick="run_demo('13564450000')">13564450000</li>
<li onclick="run_demo('13318610000')">13318610000</li>
<li onclick="run_demo('202.120.54.34')">202.120.54.34</li>
<li onclick="run_demo('61.152.239.135')">61.152.239.135</li>
<li onclick="run_demo('59.78.20.24')">59.78.20.24</li>
<li onclick="run_demo('yoursunny.com')">yoursunny.com</li>
<li onclick="run_demo('www.google.com')">www.google.com</li>
</ul>
<p>本程序的查询功能是通过分析HTML流实现的，所以当移动、联通、纯真网站改版时，就无法继续使用。我只能说，在本程序发布之时，查询功能是可以正常使用的。</p>
</td>
</tr>
</table>
</div>

<div class="b">
<h2 class="bh">相关技巧</h2>
<table class="p">
<tr>
<td class="pcont">
<h2 class="ptitle">[纯真网络]显示IP归属地(中文)</h2>
<div class="pmsg">
<p>纯真数据库侧重中国、有些甚至精确到网吧机位，其他国家很简略。</p>
<p>显示当前访问者IP的归属地<br />
<b>&lt;script type="text/javascript" src="http://www.cz88.net/ip/ipcheck.aspx"&gt;&lt;/script&gt;</b><br />
效果：<script type="text/javascript" src="http://www.cz88.net/ip/ipcheck.aspx"></script><br />
注意：该脚本使用了document.write，与XHTML冲突；XML+XSLT网页无法使用，否则……用Firefox看看就知道了</p>
<p>显示指定IP的归属地<br />
<b>&lt;script type="text/javascript" src="http://www.cz88.net/ip/ipcheck.aspx?ip=<i>IP地址</i>"&gt;&lt;/script&gt;</b><br />
效果：<script type="text/javascript" src="http://www.cz88.net/ip/ipcheck.aspx?ip=202.120.61.130"></script><br />
注意：该脚本使用了document.write，与XHTML冲突；XML+XSLT网页无法使用，否则……用Firefox看看就知道了</p>
</div>
</td>
<td class="pside">
<h2 class="ptitle">[上海移动]<br />用手机短信免费查询<br />中国移动手机归属地</h2>
<ol>
<li>发送短信 <b>114</b> 到 <b>10086</b></li>
<li>接收来自10086的提示短信，回复 <b>你要查询的手机号码</b></li>
<li>收到来自10086的短信，里面有该手机的归属地</li>
</ol>
</td>
</tr>
<tr>
<td class="pcont">
<h2 class="ptitle">[GeoIP]获取、显示IP归属国家、城市(英文)</h2>
<div class="pmsg">
<p>全世界的都有。免费的只能获得国家、城市、经纬度，而不能获得网络类型(电信/网通)等；而且只能获得当前访问者信息，而不能够查询任意IP地址。</p>
<p><b>&lt;script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"&gt;&lt;/script&gt;</b><br />
脚本中含有一系列函数调用，而没有write，需要自己处理<br />
<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<script type="text/javascript">
document.write('国家代码：'+geoip_country_code()+'<br/>国家名称：'+geoip_country_name()+'<br/>城市：'+geoip_city()+'<br/>经纬度：('+geoip_latitude()+','+geoip_longitude()+')');
</script></p>
</div>
</td>
<td class="pside">
由于GeoIP的服务包含了城市经纬度，你甚至可以用Google Maps显示当前城市地图：
<div id="googlemap_container" style="width:180px;height:180px;"></div>
看到你现在身处的位置了吗？
</td>
</tr>
</table>
</div>

</div>
<div id="footer"><div id="footercontent"></div></div>
<script type="text/javascript">
google.load('maps','2');
var googlemap=null;
google.setOnLoadCallback(function(){
	googlemap=new google.maps.Map2($('googlemap_container'));
	var point=new google.maps.LatLng(Number(geoip_latitude()),Number(geoip_longitude()));
	googlemap.setCenter(point,7);
	googlemap.setMapType(G_SATELLITE_MAP);
	googlemap.addOverlay(new GMarker(point));
});
</script>
</body></html>